<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pending Registrations - Student Course Registration</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body class="dashboard-page">
    <div class="dashboard-container">
        <!-- Header -->
        <header class="dashboard-header">
            <div class="header-left">
                <div class="logo-small">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 14l9-5-9-5-9 5 9 5z"></path>
                        <path
                            d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14z">
                        </path>
                    </svg>
                </div>
                <h1>Pending Registrations</h1>
            </div>
            <div class="header-right">
                <span class="admin-name" id="adminName">Welcome, Admin</span>
                <button id="logoutBtn" class="logout-btn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                        <polyline points="16 17 21 12 16 7"></polyline>
                        <line x1="21" y1="12" x2="9" y2="12"></line>
                    </svg>
                    <span>Logout</span>
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="dashboard-main">
            <div class="page-header">
                <a href="dashboard.html" class="back-btn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 12H5M12 19l-7-7 7-7"></path>
                    </svg>
                    Back to Dashboard
                </a>
                <h2>Registrations Awaiting AA Approval</h2>
                <p>Students waiting for Academic Advisor approval</p>
            </div>

            <!-- Summary Cards by Course -->
            <div class="pending-summary">
                <h3>Summary by Course</h3>
                <div class="summary-cards" id="summaryCards">
                    <!-- Cards will be loaded here -->
                    <div class="loading-text">Loading summary...</div>
                </div>
            </div>

            <!-- Pending Registrations Table -->
            <div class="table-container">
                <h3 class="table-title">Pending Registrations List</h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Student ID</th>
                            <th>Student Name</th>
                            <th>Course</th>
                            <th>Submitted Date</th>
                        </tr>
                    </thead>
                    <tbody id="pendingTableBody">
                        <!-- Registrations will be loaded here -->
                        <tr>
                            <td colspan="4" class="loading-row">Loading pending registrations...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </main>

        <!-- Footer -->
        <footer class="dashboard-footer">
            <p>&copy; 2026 Student Course Registration System - UTHM</p>
        </footer>
    </div>

    <script src="app.js"></script>
    <script>
        let allRegistrations = {};
        let currentFilter = null;

        // Check authentication and load data
        document.addEventListener('DOMContentLoaded', function () {
            checkAuth();
            loadPendingRegistrations();
        });

        // Load pending registrations from API
        async function loadPendingRegistrations() {
            try {
                const response = await fetch('/api/admin/getPendingRegistrations()');
                const result = await response.json();
                const data = result.value || result;

                // Store registrations globally
                allRegistrations = data.registrations;

                // Render summary cards
                renderSummaryCards(data.summary);

                // Show message to select a course
                showSelectCourseMessage();

            } catch (error) {
                console.error('Error loading pending registrations:', error);
                document.getElementById('summaryCards').innerHTML =
                    '<div class="error-text">Error loading data</div>';
                document.getElementById('pendingTableBody').innerHTML =
                    '<tr><td colspan="4" class="error-row">Error loading registrations</td></tr>';
            }
        }

        // Show message to select a course
        function showSelectCourseMessage() {
            const tbody = document.getElementById('pendingTableBody');
            tbody.innerHTML = '<tr><td colspan="4" class="empty-row">Click on a course card above to view students</td></tr>';
            document.querySelector('.table-title').textContent = 'Pending Registrations List';
        }

        // Render summary cards with click handler
        function renderSummaryCards(summary) {
            const container = document.getElementById('summaryCards');

            if (!summary || summary.length === 0) {
                container.innerHTML = '<div class="empty-text">No pending registrations</div>';
                return;
            }

            container.innerHTML = summary.map(item => `
                <div class="summary-card clickable" onclick="filterByCourse('${item.courseCode}', '${item.courseName}')">
                    <div class="summary-count">${item.pendingCount}</div>
                    <div class="summary-course">
                        <span class="course-code">${item.courseCode}</span>
                        <span class="course-name">${item.courseName}</span>
                    </div>
                </div>
            `).join('');
        }

        // Filter table by course code
        function filterByCourse(courseCode, courseName) {
            currentFilter = courseCode;

            // Update active card styling
            document.querySelectorAll('.summary-card').forEach(card => {
                card.classList.remove('active');
                if (card.querySelector('.course-code').textContent === courseCode) {
                    card.classList.add('active');
                }
            });

            // Update table title
            document.querySelector('.table-title').textContent = `Pending Registrations - ${courseCode} (${courseName})`;

            // Render filtered students
            const students = allRegistrations[courseCode] || [];
            renderPendingTable(students);
        }

        // Render pending table
        function renderPendingTable(registrations) {
            const tbody = document.getElementById('pendingTableBody');

            if (!registrations || registrations.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" class="empty-row">No pending registrations</td></tr>';
                return;
            }

            tbody.innerHTML = registrations.map(reg => `
                <tr>
                    <td><span class="student-id">${reg.studentId}</span></td>
                    <td>${reg.studentName}</td>
                    <td>
                        <span class="course-code">${reg.courseCode}</span>
                        <span class="course-name-small">${reg.courseName}</span>
                    </td>
                    <td><span class="date-badge">${formatDate(reg.submittedDate)}</span></td>
                </tr>
            `).join('');
        }

        // Format date
        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-MY', {
                day: 'numeric',
                month: 'short',
                year: 'numeric'
            });
        }
    </script>
</body>

</html>